source('~/Code/R/TC_koubei/data_load.R')
source('~/Code/R/TC_koubei/data_load.R')
fname <- list.files(dir_data)
fname
shop_info <- read.csv(file = file.path(dir_data,'shop_info.txt'))
shop_info <- read.csv(file = file.path(dir_data,'datasets','shop_info.txt'))
shop_info <- read.csv(file = file.path(dir_data,'datasets','shop_info.txt'),header = F)
shop_info <- read.csv(file = file.path(dir_data,'datasets','shop_info.txt'),
col.names = c('shop_id','city_name','location_id','per_pay','sorce',
'comment_cnt','shop_level','cate_1_name','cate_2_name','cate_3_name'))
shop_info <- read.csv(file = file.path(dir_data,'datasets','shop_info.txt'),header = F,
col.names = c('shop_id','city_name','location_id','per_pay','sorce',
'comment_cnt','shop_level','cate_1_name','cate_2_name','cate_3_name'))
user_pay <- read.csv(file = file.path(dir_data,'datasets','user_pay.txt'),header = F,
col.names = c('user_id','shop_id','time_stamp'))
source('~/Code/R/TC_koubei/data_load.R')
setwd('../attrid')
source('~/Code/R/attrid/main_hr.R')
virtDisk$tax <- 'All'
5%4
5 %%4
for (i in 1:10000){
if(i%%2 == 1 & i%%3 == 0 & i%%44 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
print(i)
}
for (i in 1:10000){
if(i%%2 == 1 & i%%3 == 0 & i%%44 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
cat(sprint('%.0f',i))
}
for (i in 1:10000000){
if(i%%2 == 1 & i%%3 == 0 & i%%44 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
cat(sprint('%.0f',i))
}
for (i in 1:10000000){
if(i%%2 == 1 & i%%3 == 0 & i%%44 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
cat(sprintf('%.0f',i))
}
for (i in 1:10000000){
if(i%%2 == 1 & i%%3 == 0 & i%%44 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
cat(sprintf('%.0f\n',i))
}
for (i in 1:10000000){
if(i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
cat(sprintf('%.0f\n',i))
}
for (i in 1:10000){
if(i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0)
cat(sprintf('%.0f\n',i))
}
while(0){
if(i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0){
cat(sprintf('%.0f\n',i))
break
}
}
i <-1
while(1){
if(i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0){
cat(sprintf('%.0f\n',i))
break
}
i <- i + 1
}
source('~/Code/R/attrid/bs_virtdisk.R')
vt_fail <- subset(virtDisk,status == 'failed' & f_time >= bt_start & f_time < bt_end)
bt_start <- as.p('2014-07-01')
bt_end <- as.p('2014-10-01')
vt_fail <- subset(virtDisk,status == 'failed' & f_time >= bt_start & f_time < bt_end)
View(vt_fail)
a <- melt(table(vt_fail$sid))
View(a)
vt_fail <- factorX(subset(virtDisk,status == 'failed' & f_time >= bt_start & f_time < bt_end))
a <- melt(table(vt_fail$sid))
View(a)
quantileX(a$value)
i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0
i
i =369
i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4 & i%%6 == 3 & i%%7 == 0 &i %%8 == 1 & i %% 9 ==0
i%%2 == 1 & i%%3 == 0 & i%%4 == 1 & i%%5 == 4
i%%6 == 3
i%%7 == 0 &i %%8 == 1
i%%7 == 0
369/7
369%% 7
sid_norm <- subset(virtDisk,status == 'failed' & f_time > bt_end)
sid_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 864400*90)
sid_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90)
vt_norm <- subset(virtDisk,sid %in% vt_norm$sid)
vt_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90)
vt_norm <- subset(virtDisk,sid %in% vt_norm$sid)
table(vt_norm$status)
vt_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90 & !(sid %in% vt_fail$sid))
vt_norm <- subset(virtDisk,sid %in% vt_norm$sid)
vt_norm <- factorX(subset(virtDisk,sid %in% vt_norm$sid))
vt_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90 &
!(sid %in% virtDisk$sid[virtDisk$status == 'failed' & virtDisk$f_time <= bt_end + 86440*90]))
vt_norm <- factorX(subset(virtDisk,sid %in% vt_norm$sid))
dir_ten <- '/home/yiyusheng/Data/tenProcess/'
load(file.path(dir_ten,'diskInfo0902.Rda'))
dir_ten <- '/home/yiyusheng/Data/tenProcess'
load(file.path(dir_ten,'diskInfo0902.Rda'))
dir_ten <- '/home/yiyusheng/Data/tencProcess'
load(file.path(dir_ten,'diskInfo0902.Rda'))
View(diskInfo0902)
a <- subset(virtDisk,sid %in% diskInfo0902$%svr_id)
a <- subset(virtDisk,sid %in% diskInfo0902$svr_id)
6569/332842
a <- subset(virtDisk,status == 'failed')
31768/332842
vt_norm_smp <- vt_norm[sample(1:nrow(vt_norm),size = disk_num - nrow(vt_fail),replace = T),]
disk_num <- 332842
vt_norm_smp <- vt_norm[sample(1:nrow(vt_norm),size = disk_num - nrow(vt_fail),replace = T),]
View(vt_norm_smp)
vt_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90 &
!(sid %in% virtDisk$sid[virtDisk$status == 'failed' & virtDisk$f_time <= bt_end + 86440*90]))
vt_norm <- factorX(subset(virtDisk,sid %in% vt_norm$sid))
vt_fail <- factorX(subset(virtDisk,status == 'failed' & f_time >= bt_start & f_time < bt_end))
vt_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90 &
!(sid %in% virtDisk$sid[virtDisk$status == 'failed' & virtDisk$f_time <= bt_end + 86440*90]))
vt_norm <- factorX(subset(virtDisk,sid %in% vt_norm$sid))
table(vt_norm$status)
vt_norm <- subset(virtDisk,status == 'failed' & f_time >= bt_end + 86440*90)
vt_norm <- subset(virtDisk,sid %in% vt_norm$sid &
!(sid %in% virtDisk$sid[virtDisk$status == 'failed' & virtDisk$f_time <= bt_end + 86440*90]))
table(vt_norm$status)
first_time_fail <- tapply(virtDisk$f_time,virtDisk$sid,min)
first_time_fail <- melt(tapply(virtDisk$f_time,virtDisk$sid,min))
View(first_time_fail)
first_time_fail$value <- as.POSIXct(first_time_fail$value,tz = 'UTC',origin = '1970-01-01')
View(first_time_fail)
vt_norm <- subset(virtDisk,sid %in% first_time_fail$Var1[first_time_fail$value > bt_end + 86400 * 90])
View(vt_norm)
vt_fail <- factorX(subset(virtDisk,status == 'failed' & f_time >= bt_start & f_time < bt_end & use_time < bt_end))
vt_fail$group <- 'positive'
first_time_fail <- melt(tapply(virtDisk$f_time,virtDisk$sid,min))
first_time_fail$value <- as.POSIXct(first_time_fail$value,tz = 'UTC',origin = '1970-01-01')
vt_norm <- subset(virtDisk,sid %in% first_time_fail$Var1[first_time_fail$value > bt_end + 86400 * 90] & use_time < bt_end)
vt_norm_smp <- factorX(vt_norm[sample(1:nrow(vt_norm),size = disk_num - nrow(vt_fail),replace = T),])
vt_smp <- rbind(vt_fail,vt_norm_smp)
vt_norm_smp$group <- 'negative'
vt_smp <- rbind(vt_fail,vt_norm_smp)
save(vt_smp,file = file.path(dir_data,'bs_virtdisk.R'))
save(vt_smp,file = file.path(dir_data,'bs_virtdisk.Rda'))
rm(list = ls())
source('head.R')
source('harzard_rate.R')
file.path(dir_data,'bs_virtdisk.Rda')
load(file.path(dir_data,'bs_virtdisk.Rda'))
source('~/Code/R/attrid/main_hr.R', echo=TRUE)
vt <- vt_smp
vt$tax <- 'All'
list[p.dev.month,r.dev.month] <- surv_disk(vt,30,'tax')
View(r.dev.month)
ggplot(vt_smp,aes(x = use_time)) + geom_histogram()
rm(list = ls())
source('head.R')
dir_ten <- '/home/yiyusheng/Data/tencProcess'
load(file.path(dir_data,'virtDisk.Rda'))
load(file.path(dir_ten,'diskInfo0902.Rda'))
bt_start <- as.p('2014-07-01')
bt_end <- as.p('2014-10-01')
disk_num <- 332842
rm(list = ls())
source('head.R')
source('iopsFunc.R')
dir_iops <- '/home/yiyusheng/Data/tencProcess/mergePartSvrid'
dir_ten <- '/home/yiyusheng/Data/tencProcess'
fname <- list.files(dir_iops)
load(file.path(dir_data,'sdSet.Rda'))
sdSet$sid <- factor(as.numeric(gsub('s','',sdSet$sid)))
sdSet$did <- as.numeric(gsub('d','',sdSet$did))
sdSet$did[is.na(sdSet$did)] <- 0
a <- fct2ori(sdSet$sid)
a <- as.numeric(a)
a <- unique(a)
summary(a)
load(file.path(dir_ten,'diskInfo0902.Rda'))
b <- unique(as.numeric(fct2ori(diskInfo0902All$svr_id)))
c <- unique(as.numeric(fct2ori(diskInfo0902$svr_id)))
summary(b);summary(c)
load(file.path(dir_ten,'failRecord_1407-1506.Rda'))
fr <- failRecord[,c('svr_id','f_time')]
a <- unique(as.numeric(fct2ori$fr$svr_id))
a <- unique(as.numeric(fct2ori(fr$svr_id))
)
max(a)
summary(fr$f_time)
load(file.path(dir_ten,'diskInfo0902.Rda'))
setwd('../tencProcess/')
# Disk Info Load. Laura Ye send me on 09/02/2016
rm(list = ls())
source('head.R')
####################################
# S1. disk info
data <- read.table(file.path(dir_data,'files','diskInfo_20160902'),header = F,fill = T,sep='\t')
names(data) <- c('id','use_time','drive','model','svr_id')
data$use_time <- as.POSIXct(data$use_time,tz = 'UTC')
data$svr_id <- factor(data$svr_id)
data$id <- NULL
data <- data[,c('svr_id','use_time','drive','model')]
dataTime <- read.table(file.path(dir_data,'files','diskInfo_20160912A'),header = F,fill = T,sep='\t')
names(dataTime) <- c('svr_id','use_time')
dataTime$use_time <- fct2ori(dataTime$use_time)
dataTime$use_time[dataTime$use_time == ''] <- '2016-09-01'
dataTime$use_time <- as.POSIXct(dataTime$use_time,tz = 'UTC',na.rm = T)
dataTime$svr_id <- factor(dataTime$svr_id)
#filter disk onshelf after 2015-07-01
diskInfo0902 <- factorX(data)
diskInfo0902$use_time_SMART <- diskInfo0902$use_time
diskInfo0902$use_time <- dataTime$use_time[match(diskInfo0902$svr_id,dataTime$svr_id)]
diskInfo0902All <- factorX(subset(diskInfo0902,!is.na(use_time)))
a <- unique(as.numeric(fct2ori(diskInfo0902$svr_id)))
max(a)
a <- unique(as.numeric(fct2ori(dataTime)))
summary(a)
a <- unique(as.numeric(fct2ori(dataTime$svr_id)))
summary(a)
a <- dataTime[duplicated(dataTime$svr_id),]
View(a)
a1 <- subset(dataTime,svr_id %in% a$svr_id)
View(a1)
a1 <- factorX(a1)
b1 <- melt(table(a1$svr_id))
View(b1)
num_ut <- melt(tapply(dataTime$use_time,dataTime$svr_id,function(x)length(unique(x))))
table(num_ut$value)
diskInfo0902 <- subset(diskInfo0902,svr_id %in% num_ut$Var1[num_ut$value == 1])
diskInfo0902 <- diskInfo0902[!deduplicated(diskInfo0902$svrid),]
diskInfo0902 <- diskInfo0902[!duplicated(diskInfo0902$svrid),]
diskInfo0902 <- factorX(data)
diskInfo0902$use_time_SMART <- diskInfo0902$use_time
diskInfo0902$use_time <- dataTime$use_time[match(diskInfo0902$svr_id,dataTime$svr_id)]
num_ut <- melt(tapply(dataTime$use_time,dataTime$svr_id,function(x)length(unique(x))))
diskInfo0902 <- subset(diskInfo0902,svr_id %in% num_ut$Var1[num_ut$value == 1])
!duplicated(diskInfo0902$svrid)
diskInfo0902a <- diskInfo0902[!duplicated(diskInfo0902$svr_id),]
dataTime <- subset(dataTime,svr_id %in% num_ut$Var1[num_ut$value == 1])
dataTime <- dataTime[!duplicated(dataTime$svr_id),]
dataTime <- factorX(dataTime[!duplicated(dataTime$svr_id),])
duplicated(diskInfo0902$)
sum(num_ut$value[num_ut$value != 1])
a <- unique(as.numeric(fct2ori(dataTime$svr_id)))
summary(a)
dataTime <- read.table(file.path(dir_data,'files','diskInfo_20160912A'),header = F,fill = T,sep='\t')
names(dataTime) <- c('svr_id','use_time')
a <- unique(as.numeric(fct2ori(dataTime$svr_id)))
summary(a)
a <- unique(dataTime$svr_id)
summary(a)
dataTime$use_time <- fct2ori(dataTime$use_time)
dataTime$use_time[dataTime$use_time == ''] <- '2016-09-01'
dataTime$use_time <- as.POSIXct(dataTime$use_time,tz = 'UTC',na.rm = T)
dataTime$svr_id <- factor(dataTime$svr_id)
num_ut <- melt(tapply(dataTime$use_time,dataTime$svr_id,function(x)length(unique(x))))
dataTime <- subset(dataTime,svr_id %in% num_ut$Var1[num_ut$value == 1])
dataTime <- factorX(dataTime[!duplicated(dataTime$svr_id),])
a <- unique(fct2num(dataTime$$$svr_id))
a <- unique(fct2num(dataTime$$svr_id))
a <- unique(fct2num(dataTime$svr_id))
summary(a)
diskInfo0902 <- factorX(data)
diskInfo0902$use_time_SMART <- diskInfo0902$use_time
diskInfo0902$use_time <- dataTime$use_time[match(diskInfo0902$svr_id,dataTime$svr_id)]
diskInfo0902All <- factorX(subset(diskInfo0902,!is.na(use_time)))
diskInfo0902All <- factorX(subset(diskInfo0902))
diskInfo0902All <- diskInfo0902
load(file.path(dir_data,'diskInfo0902.Rda'))
diskInfo0902All <- factorX(data)
diskInfo0902All$use_time_SMART <- diskInfo0902All$use_time
diskInfo0902All$use_time <- dataTime$use_time[match(diskInfo0902All$svr_id,dataTime$svr_id)]
diskInfo0902 <- factorX(subset(diskInfo0902All,use_time < as.POSIXct('2015-07-01')))
save(diskInfo0902,diskInfo0902All,svrInfo0902,file = file.path(dir_data,'diskInfo0902.Rda'))
dataTime <- read.table(file.path(dir_data,'files','diskInfo_20160912A'),header = F,fill = T,sep='\t')
names(dataTime) <- c('svr_id','use_time')
dataTime$use_time <- fct2ori(dataTime$use_time)
dataTime$use_time[dataTime$use_time == ''] <- '2016-09-01'
dataTime$use_time <- as.POSIXct(dataTime$use_time,tz = 'UTC',na.rm = T)
dataTime$svr_id <- factor(dataTime$svr_id)
num_ut <- melt(tapply(dataTime$use_time,dataTime$svr_id,function(x)length(unique(x))))
View(dataTime)
ggplot(dataTime,aes(x = svr_id,y = use_time) + geom_line()
)
ggplot(dataTime,aes(x = svr_id,y = use_time)) + geom_line()
a <- subset(dataTime,fct2num(svr_id) < 22394 )
summary(a$use_time)
quantileX(a$use_time)
b <- subset(a,use_time > as.p('2012-09-01'))
View(b)
dataTime <- subset(dataTime,svr_id %in% num_ut$Var1[num_ut$value == 1])
dataTime <- factorX(dataTime[!duplicated(dataTime$svr_id),])
a <- subset(dataTime,fct2num(svr_id) < 22394 )
b <- subset(a,use_time > as.p('2012-09-01'))
View(b)
is.unsorted(dataTime$use_time)
a <- c(1,3,2)
a <- subset(dataTime,fct2num(svr_id) < 22394 )
quantileX(a$use_time)
quantile(a$use_time,seq(0,1,0.001))
